## ðŸŽ¯ Learning Objectives

After this unit, youâ€™ll be able to:

- âœ… Identify use cases for referencing custom metadata types in formulas, default values, and validation rules
    
- âœ… Create formulas that reference custom metadata types
    
- âœ… Set default values using custom metadata
    
- âœ… Create validation rules using custom metadata
    

---

## ðŸ’¡ Introduction

Custom metadata types combined with formulas can eliminate hardcoded values and streamline automation. Letâ€™s see how **Acme Services** uses them across fields, formulas, and rules.

---

## ðŸ“ Set a Default Value from Custom Metadata

### Goal

Default all new **Account** records to the `Bronze` support tier.

### Steps

1. Go to **Setup â†’ Object Manager â†’ Account**
    
2. Click **Fields & Relationships â†’ New**
    
3. Select **Picklist** â†’ Click **Next**
    
4. **Label**: `Support Tier`  
    **Values**: `Bronze`, `Silver`, `Gold`  
    **Required**: âœ…  
    **Default Value**:
    
    ```plaintext
    $CustomMetadata.Support_Tier__mdt.Bronze.MasterLabel
    ```
    
5. Click **Next â†’ Next â†’ Save**
    

> ðŸ”Ž **Note**: Thereâ€™s no default UI picker for custom metadata, so use the syntax:

```plaintext
$CustomMetadata.CustomMetadataTypeAPIName.RecordName.FieldAPIName
```

- `__mdt` for metadata type
    
- `__c` for fields
    
- No suffix for record names
    

---

## âœ… Use Custom Metadata in Validation Rules

### Scenario

Accounts shouldn't have a high support tier unless their **spending meets the threshold**.

### 1. Create a Roll-Up Summary Field

- Object: **Account** â†’ Fields & Relationships â†’ **New**
    
- Type: **Roll-Up Summary**
    
- Label: `Total Spending`
    
- Summarized Object: `Opportunities`
    
- Roll-Up Type: `SUM`
    
- Field to Aggregate: `Amount`
    

### 2. Create the Validation Rule

- Go to **Validation Rules â†’ New**
    
- **Rule Name**: `Minimum Spending Validation`
    
- Formula:
    

```plaintext
IF(
 (ISPICKVAL(Support_Tier__c , "Silver") &&
   (Total_Spending__c < $CustomMetadata.Support_Tier__mdt.Silver.Minimum_Spending__c))
 ||
 (ISPICKVAL(Support_Tier__c , "Gold") &&
   (Total_Spending__c < $CustomMetadata.Support_Tier__mdt.Gold.Minimum_Spending__c)),
 TRUE, FALSE
)
```

- **Error Message**:  
    `Dollar value too low for this support tier`
    

### Test It:

1. Create an Account: `Beebs Publishing`
    
2. Add Opportunity: `Beebs Publishing Q1`
    
    - Stage: `Closed Won`
        
    - Amount: `$0`
        
3. Try setting Support Tier to `Gold` â†’ Youâ€™ll see an error.
    
4. Update Opportunity Amount to `$10,000`
    
5. Try again â†’ âœ… You can now save with `Gold`
    

> âœ… With custom metadata, update values once in records instead of editing multiple rules.

---

## ðŸ§® Use Custom Metadata in a Formula Field

### Goal

Show how much more an account needs to spend to reach the next tier.

### Steps

1. **Account Object â†’ Fields & Relationships â†’ New**
    
2. Type: **Formula**
    
3. Label: `Amount Until Next Tier`
    
4. Return Type: `Currency`, Decimal Places: `2`
    

### Formula:

```plaintext
IF(Total_Spending__c < $CustomMetadata.Support_Tier__mdt.Bronze.Minimum_Spending__c,
   $CustomMetadata.Support_Tier__mdt.Bronze.Minimum_Spending__c - Total_Spending__c,
   IF(Total_Spending__c < $CustomMetadata.Support_Tier__mdt.Silver.Minimum_Spending__c,
      $CustomMetadata.Support_Tier__mdt.Silver.Minimum_Spending__c - Total_Spending__c,
      IF(Total_Spending__c < $CustomMetadata.Support_Tier__mdt.Gold.Minimum_Spending__c,
         $CustomMetadata.Support_Tier__mdt.Gold.Minimum_Spending__c - Total_Spending__c,
         0)))
```

### Finish:

- **Check Syntax** â†’ âœ…
    
- Make field visible to all profiles
    
- Add to Account layout â†’ **Save**
    

### Test It:

- Account: `Beebs Publishing`
    
- Support Tier: `Bronze`
    
- Opportunity Amount: `$700`
    
- Result in field: `Amount Until Next Tier = $300`
    

---

## ðŸ§  Why Use Custom Metadata in Formulas?

- **Centralized updates**: Change one value in a metadata record, and all formulas update automatically
    
- **Scalable**: Great for packaging apps with customizable logic
    
- **Flexible**: Subscribers can change pricing or thresholds without editing formulas
    
